# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Claude Code Settings

## Repository Overview

This is a React FastAPI template for building full-stack applications with React frontend (Vite) and FastAPI backend, designed for deployment to OpenShift using Docker containers and Kustomize.

## Project Structure

```
├── backend/              # FastAPI backend
│   ├── main.py          # Main FastAPI application
│   ├── pyproject.toml   # Python dependencies and project config
│   ├── uv.lock          # Locked dependency versions
│   ├── Dockerfile       # Backend container
│   └── CLAUDE.md        # Backend-specific Claude instructions
├── frontend/            # React frontend with Vite
│   ├── src/            # React source code
│   ├── package.json    # Node.js dependencies
│   ├── Dockerfile      # Frontend container
│   └── CLAUDE.md       # Frontend-specific Claude instructions
├── k8s/                # Kubernetes/OpenShift manifests
│   ├── base/          # Base kustomize resources
│   └── overlays/      # Environment-specific overlays
└── scripts/           # Deployment automation scripts
```

## Development Commands

### Local Development (Node.js/Python)
```bash
make setup             # Install all dependencies
make dev              # Run both frontend and backend
make dev-frontend     # Run React dev server (port 8080)
make dev-backend      # Run FastAPI server (port 8000)
make help             # Show all available commands
```

### Building
```bash
make build                 # Build frontend and container images
```

### Testing
```bash
make test             # Run all tests (frontend and backend)
make test-frontend    # Run frontend tests only
make test-backend     # Run backend tests only
make lint             # Run linting
```

### Container Registry (Quay.io)
```bash
make build                            # Build frontend and container images
make push                             # Push images to registry
make TAG=v1.0.0 REGISTRY=quay.io/cfchase # Custom registry and tag
```


### OpenShift Deployment
```bash
# Build and push images
make build && make push

# Deploy to OpenShift (single overlay approach - this is a demo app)
make deploy           # Deploy to OpenShift
make undeploy         # Remove deployment
make kustomize        # Preview manifests

# The deployment uses the 'deploy' overlay in k8s/overlays/deploy/
# Configure your API key in k8s/overlays/deploy/.env before deploying
```

**Important**: This is a demo application with a single deployment overlay. 
Do not create separate dev/prod overlays - use the single 'deploy' overlay for all deployments.

## Configuration Files

### Environment Variables
- `backend/.env` - Backend configuration for local development only (copy from .env.example)
- `k8s/overlays/deploy/.env` - Environment variables for OpenShift deployment (used by kustomize secret generator)
- `frontend/.env` - Frontend configuration (copy from .env.example)

**Important**: All `.env*` files are excluded from Docker builds via `.dockerignore`. Deployment environment variables are managed through kustomize secret generators.

### Key Configuration
- `vite.config.ts` - Vite configuration with proxy to backend
- `docker-compose.yml` - Local development with containers
- `k8s/base/kustomization.yaml` - Base Kubernetes resources
- `k8s/overlays/deploy/kustomization.yaml` - Deployment configuration

## Development Workflow

1. Make changes to frontend (React) or backend (FastAPI)
2. Test locally with `make dev`
3. Build everything with `make build`
4. Build and push containers with `make build && make push`
5. Deploy to OpenShift with `make deploy`

## Common Tasks

### Adding New Dependencies
- Frontend: `cd frontend && npm install <package>`
- Backend: `cd backend && uv add <package>` (automatically updates pyproject.toml and uv.lock)
- Backend Dev Dependencies: `cd backend && uv add --dev <package>`

### Updating Container Images
- Update image tags in `k8s/base/kustomization.yaml`
- Update tags in overlay files for environment-specific versions

### Managing Secrets in OpenShift
- **Local Development**: Update `backend/.env` with your local API keys
- **OpenShift Deployment**: Update `k8s/overlays/deploy/.env` with your API keys
- Environment variables include:
  - `API_KEY`: Your LLM provider API key (OpenAI, Anthropic, Google, etc.)
  - `MODEL`: Model to use (default: gpt-3.5-turbo)
  - `PROVIDER`: Optional provider override (auto-detected from model name)
  - `API_BASE_URL`: Optional custom API base URL for OpenAI-compatible endpoints
  
**Important**: Secrets are automatically generated by kustomize from the .env files in each overlay directory. The deployment scripts (`make deploy` and `make deploy-prod`) use kustomize's built-in secret generator.

### Customizing for New Projects
- Update image names in kustomization files
- Update registry in build script
- Add API endpoints in `backend/main.py`
- Update frontend components in `frontend/src/`
- Update .env files with your actual API keys
- The template provides a minimal foundation - add your business logic as needed

## Git Commit Guidelines

When creating commits in this repository:
- **DO NOT** include Claude Code attribution in commit messages
- **DO NOT** include Claude-specific references in commit messages
- **DO NOT** mention "Generated with Claude Code" or similar attributions
- **DO NOT** add Co-Authored-By references to Claude
- Focus commit messages on the technical changes made
- Use conventional commit format when appropriate (feat:, fix:, docs:, etc.)